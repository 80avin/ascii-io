var R=Object.defineProperty;var L=(g,t,e)=>t in g?R(g,t,{enumerable:!0,configurable:!0,writable:!0,value:e}):g[t]=e;var h=(g,t,e)=>L(g,typeof t!="symbol"?t+"":t,e);(function(){const t=document.createElement("link").relList;if(t&&t.supports&&t.supports("modulepreload"))return;for(const n of document.querySelectorAll('link[rel="modulepreload"]'))s(n);new MutationObserver(n=>{for(const i of n)if(i.type==="childList")for(const o of i.addedNodes)o.tagName==="LINK"&&o.rel==="modulepreload"&&s(o)}).observe(document,{childList:!0,subtree:!0});function e(n){const i={};return n.integrity&&(i.integrity=n.integrity),n.referrerPolicy&&(i.referrerPolicy=n.referrerPolicy),n.crossOrigin==="use-credentials"?i.credentials="include":n.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function s(n){if(n.ep)return;n.ep=!0;const i=e(n);fetch(n.href,i)}})();const S={alphanumeric:" qwertyuiopasdfghjklzxcvbnmQWERTYUIOPASDFGHJKLZXCVBNM[];',./{}:\"<>?`1234567890-=~!@#$%^&*()_+",block:" ▁▂▃▄▅▆▇█▉▊▋▌▍▎▏▐░▒▓▔▕▖▗▘▙▚▛▜▝▞▟▀▄▌▐▖▗▘▙▚▛▜▝▞▟"};class T{constructor(){h(this,"charIntensities",[]);h(this,"currentCharacterSet","alphanumeric");h(this,"previewCanvas");h(this,"previewCtx");h(this,"imageAspectRatio",null);h(this,"exposureValue",1);h(this,"autoGenerate",!1);h(this,"autoGenerateTimeout",null);h(this,"textSizes",{small:32,medium:48,large:64});this.previewCanvas=document.getElementById("preview-canvas"),this.previewCtx=this.previewCanvas.getContext("2d"),this.initializeCharacterIntensities(),this.setupEventListeners()}async initializeCharacterIntensities(){const t=document.createElement("canvas"),e=t.getContext("2d"),s=20;t.width=s,t.height=s,e.font=`${s}px monospace`,e.textAlign="center",e.textBaseline="middle",await this.generateCharacterIntensities(e,s)}async generateCharacterIntensities(t,e){const s=[],n=S[this.currentCharacterSet];for(const i of n){t.fillStyle="white",t.fillRect(0,0,e,e),t.fillStyle="black",t.fillText(i,e/2,e/2);const o=t.getImageData(0,0,e,e);let a=0;for(let c=0;c<o.data.length;c+=4){const d=o.data[c],u=o.data[c+1],x=o.data[c+2],y=.299*d+.587*u+.114*x;a+=y}const m=a/(e*e);s.push({char:i,intensity:m})}this.charIntensities=s.sort((i,o)=>i.intensity-o.intensity),console.log("Character intensities initialized for",this.currentCharacterSet,":",this.charIntensities)}measureCharacterAspectRatio(){const t=document.createElement("canvas"),e=t.getContext("2d"),s=document.getElementById("output"),n=window.getComputedStyle(s),i=n.fontFamily,o=parseFloat(n.fontSize);t.width=100,t.height=100,e.font=`${o}px ${i}`,e.textAlign="left",e.textBaseline="top";const a=e.measureText("M"),m=a.width,d=a.actualBoundingBoxAscent+a.actualBoundingBoxDescent||o*.8,u=m/d;return console.log(`Character aspect ratio: ${u} (width: ${m}, height: ${d})`),u}getCorrectedAspectRatio(t){const e=this.measureCharacterAspectRatio();return t*e}debouncedGenerate(){this.autoGenerate&&(this.autoGenerateTimeout&&clearTimeout(this.autoGenerateTimeout),this.autoGenerateTimeout=window.setTimeout(()=>{this.generateAsciiArt()},500))}setupEventListeners(){document.querySelectorAll(".tab-button").forEach(r=>{r.addEventListener("click",l=>{const A=l.target.dataset.tab;this.switchTab(A)})});const e=document.getElementById("character-set");e.addEventListener("change",()=>{this.currentCharacterSet=e.value,this.initializeCharacterIntensities(),this.autoGenerate&&this.previewCanvas.width>0&&this.debouncedGenerate()});const s=document.getElementById("image-input"),n=document.getElementById("file-upload");s.addEventListener("change",r=>{var p;const l=(p=r.target.files)==null?void 0:p[0];l&&this.handleImageUpload(l)}),n.addEventListener("dragover",r=>{r.preventDefault(),n.classList.add("dragover")}),n.addEventListener("dragleave",()=>{n.classList.remove("dragover")}),n.addEventListener("drop",r=>{var p;r.preventDefault(),n.classList.remove("dragover");const l=(p=r.dataTransfer)==null?void 0:p.files[0];l&&l.type.startsWith("image/")&&this.handleImageUpload(l)});const i=document.getElementById("text-input"),o=document.getElementById("font-select"),a=document.getElementById("text-size");i.addEventListener("input",()=>this.handleTextInput()),o.addEventListener("change",()=>this.handleTextInput()),a.addEventListener("change",()=>this.handleTextInput()),document.getElementById("generate-btn").addEventListener("click",()=>this.generateAsciiArt());const c=document.getElementById("copy-btn"),d=document.getElementById("download-btn");c.addEventListener("click",()=>this.copyToClipboard()),d.addEventListener("click",()=>this.downloadAsText());const u=document.getElementById("lock-aspect-ratio"),x=document.getElementById("columns"),y=document.getElementById("rows");u.addEventListener("change",()=>{u.checked&&this.imageAspectRatio&&this.updateAspectRatioConstrainedValues()}),x.addEventListener("input",()=>{u.checked&&this.imageAspectRatio&&this.updateRowsFromColumns(),this.autoGenerate&&this.debouncedGenerate()}),y.addEventListener("input",()=>{u.checked&&this.imageAspectRatio&&this.updateColumnsFromRows(),this.autoGenerate&&this.debouncedGenerate()});const E=document.getElementById("auto-generate");E.addEventListener("change",()=>{this.autoGenerate=E.checked,this.autoGenerate&&this.previewCanvas.width>0&&this.debouncedGenerate()});const f=document.getElementById("font-size-slider"),w=document.getElementById("font-size-value"),C=document.getElementById("output");f&&w&&C&&f.addEventListener("input",()=>{const r=f.value;w.textContent=`${r}px`,C.style.fontSize=`${r}px`});const I=document.getElementById("exposure-slider"),v=document.getElementById("exposure-value");I&&v&&I.addEventListener("input",()=>{this.exposureValue=parseFloat(I.value),v.textContent=`${this.exposureValue.toFixed(1)}x`,this.autoGenerate&&this.debouncedGenerate()}),this.handleTextInput()}switchTab(t){var e,s;document.querySelectorAll(".tab-button").forEach(n=>{n.classList.remove("active")}),(e=document.querySelector(`[data-tab="${t}"]`))==null||e.classList.add("active"),document.querySelectorAll(".tab-content").forEach(n=>{n.classList.remove("active")}),(s=document.getElementById(`${t}-tab`))==null||s.classList.add("active"),this.clearPreview()}async handleImageUpload(t){const e=new Image;e.onload=()=>{this.drawImagePreview(e)},e.src=URL.createObjectURL(t)}drawImagePreview(t){this.imageAspectRatio=t.width/t.height;let{width:n,height:i}=t;if(n>400||i>300){const o=Math.min(400/n,300/i);n*=o,i*=o}this.previewCanvas.width=n,this.previewCanvas.height=i,this.previewCtx.drawImage(t,0,0,n,i),this.showAspectRatioControl(),this.autoGenerate&&this.debouncedGenerate()}handleTextInput(){const t=document.getElementById("text-input"),e=document.getElementById("font-select"),s=document.getElementById("text-size"),n=t.value.trim();if(!n){this.clearPreview();return}const i=e.value,o=s.value,a=this.textSizes[o];this.drawTextPreview(n,i,a)}drawTextPreview(t,e,s){this.previewCtx.font=`${s}px "${e}"`;const n=this.previewCtx.measureText(t),i=20,o=n.width+i*2,a=s*1.5+i*2;this.previewCanvas.width=o,this.previewCanvas.height=a,this.imageAspectRatio=o/a,this.previewCtx.fillStyle="white",this.previewCtx.fillRect(0,0,o,a),this.previewCtx.fillStyle="black",this.previewCtx.font=`${s}px "${e}"`,this.previewCtx.textAlign="center",this.previewCtx.textBaseline="middle",this.previewCtx.fillText(t,o/2,a/2),this.showAspectRatioControl(),this.autoGenerate&&this.debouncedGenerate()}clearPreview(){this.previewCanvas.width=400,this.previewCanvas.height=300,this.previewCtx.fillStyle="#f8f9fa",this.previewCtx.fillRect(0,0,this.previewCanvas.width,this.previewCanvas.height),this.previewCtx.fillStyle="#6c757d",this.previewCtx.font="16px Roboto",this.previewCtx.textAlign="center",this.previewCtx.textBaseline="middle",this.previewCtx.fillText("Preview will appear here",this.previewCanvas.width/2,this.previewCanvas.height/2),this.hideAspectRatioControl()}showAspectRatioControl(){const t=document.getElementById("aspect-ratio-control");t.style.display="block"}hideAspectRatioControl(){const t=document.getElementById("aspect-ratio-control"),e=document.getElementById("lock-aspect-ratio");t.style.display="none",e.checked=!1,this.imageAspectRatio=null}updateAspectRatioConstrainedValues(){if(!this.imageAspectRatio)return;const t=document.getElementById("columns"),e=document.getElementById("rows"),s=parseInt(t.value),n=this.getCorrectedAspectRatio(this.imageAspectRatio),i=Math.round(s/n),o=Math.max(50,Math.min(1e3,i));if(e.value=o.toString(),o!==i){const a=Math.round(o*n);t.value=Math.max(50,Math.min(1e3,a)).toString()}}updateRowsFromColumns(){if(!this.imageAspectRatio)return;const t=document.getElementById("columns"),e=document.getElementById("rows"),s=parseInt(t.value),n=this.getCorrectedAspectRatio(this.imageAspectRatio),i=Math.round(s/n),o=Math.max(50,Math.min(1e3,i));e.value=o.toString()}updateColumnsFromRows(){if(!this.imageAspectRatio)return;const t=document.getElementById("columns"),e=document.getElementById("rows"),s=parseInt(e.value),n=this.getCorrectedAspectRatio(this.imageAspectRatio),i=Math.round(s*n),o=Math.max(50,Math.min(1e3,i));t.value=o.toString()}async generateAsciiArt(){const t=document.getElementById("generate-btn"),e=document.getElementById("output");if(this.charIntensities.length===0){e.value="Error: Character intensities not yet calculated. Please wait a moment and try again.";return}t.disabled=!0,t.textContent="Generating...";try{const s=document.getElementById("columns"),n=document.getElementById("rows"),i=parseInt(s.value),o=parseInt(n.value);if(i<50||i>1e3||o<50||o>1e3)throw new Error("Columns and rows must be between 50 and 1000");if(this.previewCanvas.width===0||this.previewCanvas.height===0)throw new Error("No preview image. Please upload an image or enter text first.");const a=await this.convertCanvasToAscii(i,o);e.value=a}catch(s){e.value=`Error: ${s instanceof Error?s.message:"Unknown error occurred"}`}finally{t.disabled=!1,t.textContent="Generate ASCII Art"}}async convertCanvasToAscii(t,e){const s=this.previewCtx.getImageData(0,0,this.previewCanvas.width,this.previewCanvas.height),{width:n,height:i}=s,o=n/t,a=i/e;let m="";for(let c=0;c<e;c++){for(let d=0;d<t;d++){const u=Math.floor(d*o),x=Math.floor((d+1)*o),y=Math.floor(c*a),E=Math.floor((c+1)*a);let f=0,w=0;for(let v=y;v<E&&v<i;v++)for(let r=u;r<x&&r<n;r++){const l=(v*n+r)*4,p=s.data[l],A=s.data[l+1],b=s.data[l+2],B=.299*p+.587*A+.114*b;f+=B,w++}let C=w>0?f/w:0;C=this.applyExposure(C);const I=this.getClosestAsciiChar(C);m+=I}c<e-1&&(m+=`
`)}return m}getClosestAsciiChar(t){let e=this.charIntensities[0],s=Math.abs(e.intensity-t);for(const n of this.charIntensities){const i=Math.abs(n.intensity-t);i<s&&(s=i,e=n)}return e.char}applyExposure(t){const e=t/255,s=Math.pow(e,1/this.exposureValue);return Math.max(0,Math.min(255,s*255))}async copyToClipboard(){const t=document.getElementById("output"),e=document.getElementById("copy-btn");if(!t.value.trim()){alert("No ASCII art to copy. Please generate some first.");return}try{await navigator.clipboard.writeText(t.value);const s=e.textContent;e.textContent="Copied!",e.style.background="#27ae60",setTimeout(()=>{e.textContent=s,e.style.background=""},2e3)}catch{t.select(),document.execCommand("copy"),alert("ASCII art copied to clipboard!")}}downloadAsText(){const t=document.getElementById("output");if(!t.value.trim()){alert("No ASCII art to download. Please generate some first.");return}const e=new Blob([t.value],{type:"text/plain"}),s=URL.createObjectURL(e),n=document.createElement("a");n.href=s,n.download=`ascii-art-${new Date().toISOString().split("T")[0]}.txt`,document.body.appendChild(n),n.click(),document.body.removeChild(n),URL.revokeObjectURL(s)}}document.addEventListener("DOMContentLoaded",()=>{new T});
